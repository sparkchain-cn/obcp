<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<title>用户列表</title>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="format-detection" content="telephone=no">
<link rel="stylesheet" href="/admin/layui/css/layui.css" media="all" />
<link rel="stylesheet"
	href="//at.alicdn.com/t/font_tnyc012u2rlwstt9.css" media="all" />
<link rel="stylesheet" href="/admin/css/main.css" media="all" />
<link rel="stylesheet" type="text/css" href="/admin/css/form.css" />

<script type="text/javascript" src="/admin/layui/layui.js"></script>
<script type="text/javascript" src="/js/main.js"></script>
<!--<script src="../../js/user/newsList.js" type="text/javascript" charset="utf-8"></script>-->
</head>

<body class="childrenBody layui-bg-gray">
	<div class="layui-fluid layui-bg-white">

		<div class="" id="search_app" class="search">
			<div class="layui-form" action="">
				<div class="layui-form-item layui-form-item1">
				 	<div class="layui-inline">
						
						<label class="layui-form-label layui-form-label1">用户ID:</label>
						<div class="layui-input-inline">
							<input type="name" id="id" name="id" autocomplete="off"
								class="layui-input" placeholder="请输入用户ID">
						</div>
					</div> 
					<div class="layui-inline">
						<label class="layui-form-label layui-form-label1">手机号码:</label>
						<div class="layui-input-inline">
							<input type="name" id="mobile" name="mobile" autocomplete="off"
								class="layui-input" placeholder="请输入手机号码">
						</div>
					</div>
					<div class="layui-inline">
						<label class="layui-form-label layui-form-label1">昵称:</label>
						<div class="layui-input-inline">
							<input type="name" id="nickname" name="nickname"
								autocomplete="off" class="layui-input" placeholder="请输入昵称">
						</div>
					</div>
					<div class="layui-inline">
						<button class="layui-btn layui-btn-normal" id="searchBtn"
							data-type="getInfo">
							<i class="layui-icon ">&#xe615;</i> 搜索
						</button>
						<button class="layui-btn layui-btn-normal" data-type="add"
							id="addBtn">添加</button>
					</div>
				</div>
				</form>

			</div>
		</div>

		<div class="layui-fluid layui-bg-white">
			<table id="userIndex" lay-filter="userIndex"></table>
		</div>
</body>

<script type="text/html" id="sexItem">
		{{# if (d.sex == 1){ }} 男 {{# } else if(d.sex == 2){ }} 女 {{# } else { }} 你是个什么生物？ {{# } }}
	</script>
<script type="text/html" id="roleName">
			
			{{# 	if(d.roleName){ }}
				{{#		var array = d.roleName.split(",") || [];}}
					{{#	for(var i=0 ;i<array.length ;i++) { }}
							 <button class="layui-btn layui-btn-primary layui-btn-xs" >{{ array[i] }}</button>
					{{#	} }}
			{{#	}else { }}
 						 
				{{# } }}
	</script>

<script type="text/html" id="state">
		{{# if (d.state == 1){}}
		<span style="color: #FFCE4E;">正常</span>
		{{# } else if(d.state == 2){ }}
		<span>已禁用</span>
		{{# } }}
	</script>
<!-- 	<a class="layui-btn layui-btn-xs" lay-event="bindRole">绑定角色</a>	 -->
<script type="text/html" id="options">		
		<a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>	
		<a class="layui-btn layui-btn-xs" lay-event="view">查看信息</a>	
		<a class="layui-btn layui-btn-xs" lay-event="viewRole">查看权限</a>
		<a class="layui-btn layui-btn-xs" lay-event="createApp">创建应用</a>
	</script>

<script type="text/javascript">
		layui.use(['table', "form", "jquery", "laytpl", "laydate","layer","util"], function() {
			var table = layui.table,
				form = layui.form,
				layer = layui.layer,
				util=layui.util,queryObj={state:1},
				$ = layui.jquery,curr=1,prePath="${prePath}";
						
			var render = table.render({
				method: 'post',
				elem: '#userIndex',
				url: '/v1/userextend/userPlatList',
				//contentType:"application/json; charset=UTF-8",				
				page: 1, //开启分页
				limit:10,
				where:queryObj,
				loading:true,
				request: {
                    pageName: 'pagenum',
                    limitName: 'pagesize'
                },
				done:function(res, currPage, count){
		  			curr = currPage;
		  		},
				cols: [
					[ //表头
					 	{
							field: 'id',
							title: '用户ID',
							width: '15%',
							align:"center"
						},{
                        field: 'nickname',
                        title: '昵称',
                        width: '15%',
                        align:"center"
                   	 	},{
                        field: 'mobile',
                        title: '手机号码',
                        width: '10%',
                        align:"center"
                    	}, {
							field: 'name',
							title: '姓名',
							width: '15%',
							align:"center"
						},
						 {
							field: 'createtime',
							title: '注册时间',
							align:"center",
							width: '15%',
						  templet:function(item){
			                    if(item.createtime)
			                        return util.toDateString(item.createtime,"yyyy-MM-dd HH:mm:ss");
			                    else
			                        return "";
			                }
						}, 
						{
							title: '操作',
							align:"center",
							toolbar: '#options'
						}
					]
				]
			});
			
			//表格渲染
			var tableRender = function(){
				render.reload({where:queryObj, page: {
				    curr: curr
				  }});	
			}

		   $("#addBtn").on("click",function(){
			   layer.open({
			        type: 2,
			        title: '新增用户',			      
			        resize: false,
			        area: ['100%', '100%'],
			        content: '/user/userAdd',
			        zIndex: layer.zIndex, //重点1,
			        end:function () {	        	
			        	render.reload({where:queryObj, page: {
						    curr: 1
						  }});		        	
			        }
			      });
		   });
			//搜索
			
			$('#searchBtn').on('click',function(){	
				var nickname=$('#nickname').val(),mobile = $("#mobile").val();
				queryObj= {state:1};
				if(nickname){queryObj.nickname = nickname.trim()};		
				if(mobile){queryObj.mobile = mobile.trim()};
				render.reload({where:queryObj,page: {
				    curr: 1 
				  }});	
			 });
			    // 点击获取数据
			    var  active = {
			 		getInfo: function () {
			          tableRender();
			        }
			    };
			//是否展示
			form.on('switch(isShow)', function(data) {
				var index = layer.msg('修改中，请稍候', {
					icon: 16,
					time: false,
					shade: 0.8
				});
				setTimeout(function() {
					layer.close(index);
					layer.msg("展示状态修改成功！");
				}, 2000);
			})

			//操作
			table.on('tool(userIndex)', function(obj) {
				var data = obj.data;
				if(obj.event === 'edit') {
					layer.open({
						title: "编辑" + data.nickname + "信息",
						type: 2,
						move: false,
						content:  '/user/userAdd?userId=' + data.id,
						area: ["100%", "100%"],
						end: function() {
							tableRender();				
						},				
						resize: false,
						scrollbar: false,
					})
				}else if(obj.event == "view"){
					layer.open({
						title: "用户详情",
						type: 2,
						move: false,
						content:'/user/userInfo?userId=' + data.id,
						area: ["100%", "100%"],
						end: function() {
								
						},				
						resize: false,
						scrollbar: false,
					})
				}else if( obj.event == "viewRole"){
					layer.open({
						title: "用户权限",
						type: 2,
						move: false,
						content:'/user/userRoleResource?userId=' + data.id,
						area: ["100%", "100%"],
						end: function() {
								
						},				
						resize: false,
						scrollbar: false,
					})
				}else if(obj.event == "createApp"){
				    layer.open({
						title:"创建应用",
						type:2,
						move:false,
						content:prePath +"/v0/appPage/createapp&appUserId="+data.id+"&appUserName="+data.nickname,
						area:["100%","100%"]
					})
				}
			});
		});
		
		
	</script>

</html>