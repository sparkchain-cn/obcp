<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/admin/layui/css/layui.css" media="all" />
    <link rel="stylesheet"
    <link rel="stylesheet" href="/admin/css/main.css" media="all" />
    <link rel="stylesheet" type="text/css" href="/admin/css/form.css" />

    <script type="text/javascript" src="/admin/layui/layui.js"></script>
</head>
<body>
<form id="roleForm" class="layui-form layui-form-pane" action=""
      style="margin: 20px">

        <div class="layui-form-item">
            <label class="layui-form-label" style="width: 120px">用户Token：</label>
            <div class="">
                <#assign userMap=userTokens/>
                <#assign  keys=userMap?keys/>
                <#list keys as key>
                    <input type="text" readonly="readonly" value="${key}"
                           autocomplete="off" class="layui-input layui-input-block" style="width: 500px;margin-left: 121px;margin-bottom: 12px;">
                </#list>
            </div>
        </div>


    <div class="layui-form-item">
        <label class="layui-form-label" style="width: 120px">用户名：</label>
        <div class="layui-input-block">
            <input type="text" name="nickName" id="nickName" readonly="readonly" value="${nickName}"
                   autocomplete="off" class="layui-input" style="width: 500px">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label" style="width: 120px">过期时间：</label>
        <div class="layui-input-block">
            <input type="text" name="expireTime" id="expireTime" lay-verify="required"
                   autocomplete="off" class="layui-input" style="width: 500px">
        </div>
    </div>
    <div class="layui-form-item" style="text-align: center;">
        <a class="layui-btn" lay-submit="" lay-filter="submitBtn">创建</a>
    </div>
</form>
</body>
<script>
    layui.use(['form','jquery','laydate'],function () {
        var $ = layui.jquery,form = layui.form,laydate = layui.laydate;

        laydate.render({
            elem: '#expireTime' //指定元素
        });

        form.on("submit(submitBtn)",function (data) {
            var loading = layer.load(1);
            data.field.scope = -1;
            $.post("/v1/usertoken/createUserToken", data.field,function (response) {
                layer.close(loading);
                if(response){
                    if(response.code == 200){
                        layer.msg("保存成功！", {
                            icon: 6,
                            time: 1000
                        }, function() {
                            var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
                            parent.layer.close(index); //再执行关闭
                        });
                    }else{
                        layer.msg(response.message, {
                            icon: 5,
                            time: 2000
                        });
                    }
                }else {
                    layer.msg("失败！");
                }
            }).error(function(){
                layer.close(loading);
                layer.msg("错误！");
            });
        }) ;
    })
</script>
</html>