<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>首页--layui后台管理模板</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="format-detection" content="telephone=no">
		<link rel="stylesheet" href="../../layui/css/layui.css" media="all" />
		<link rel="stylesheet" href="//at.alicdn.com/t/font_tnyc012u2rlwstt9.css" media="all" />
		<link rel="stylesheet" href="../../css/main.css" media="all" />
		<link rel="stylesheet" type="text/css" href="../../css/form.css"/>
		
		<script type="text/javascript" src="../../layui/layui.js"></script>
		<script type="text/javascript" src="../../js/main.js"></script>
		<!--<script src="../../js/user/newsList.js" type="text/javascript" charset="utf-8"></script>-->
	</head>

	<body class="childrenBody layui-bg-gray">
		<div class="layui-fluid layui-bg-white">

			<div class="" id="search_app" class="search">
				<form class="layui-form" action="">
					<div class="layui-form-item layui-form-item1">
						<div class="layui-inline">
							<label class="layui-form-label layui-form-label1">姓名</label>
							<div class="layui-input-inline">
								<input type="name" name="url" autocomplete="off" class="layui-input" id="userName" placeholder="请输入姓名">
							</div>
						</div>
						<div class="layui-inline">
							<label class="layui-form-label layui-form-label1">状态：</label>
							<div class="layui-input-inline">
								<select name="type" lay-verify="required" id="typeselect">
								</select>
							</div>
						</div>
						<div class="layui-inline">
							<label class="layui-form-label layui-form-label1">物流商名称：</label>
							<div class="layui-input-inline">
								<input type="tel" name="url" autocomplete="off" class="layui-input" id="userName" placeholder="请输入物流商名称">
							</div>
						</div>
						<div class="layui-inline">
							<label class="layui-form-label layui-form-label1">最后登录时间：</label>
							<div class="layui-input-inline">
								<input type="text" class="layui-input" id="begindate" placeholder="请选择开始日期">
							</div>
							<div class="layui-input-inline layui-input-inline1">
								~
							</div>
							<div class="layui-input-inline">
								<input type="text" class="layui-input" id="lastdate" placeholder="请选择结束日期">
							</div>
						</div>
						<div class="layui-inline">
							<button class="layui-btn layui-btn-normal" id="searchBtn" data-type="getInfo"><i class="layui-icon ">&#xe615;</i> 搜索</button>
						</div>
					</div>
				</form>

			</div>
		</div>

		<div class="layui-fluid layui-bg-white">
			<table id="demo" lay-filter="test"></table>

		</div>

	</body>

	<!--编辑-->
	<div class="appedit" style="display:none;">
		<div class="layui-row bg_color">
			<div class="layui-col-xs12">
				<div class="layui-card">
					<div class="layui-card-body">
						<form class="layui-form" action="">
							<div class="layui-form-item">
								<label class="layui-form-label">姓名</label>
								<div class="layui-input-block">
									<input type="text" name="username" placeholder="请输入姓名" autocomplete="off" class="layui-input">
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label">手机</label>
								<div class="layui-input-block">
									<input type="text" name="phone" placeholder="请输入手机" autocomplete="off" class="layui-input">
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label">职务</label>
								<div class="layui-input-block">
									<input type="text" name="position" placeholder="请输入负责人" autocomplete="off" class="layui-input">
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label">部门</label>
								<div class="layui-input-block">
									<select name="department">
										<option value=""></option>
										<option value="0">产品</option>
										<option value="1">行政</option>
										<option value="2">研发</option>
										<option value="3">市场</option>
										<option value="4">质量保障</option>
									</select>
								</div>
							</div>
							<div class="layui-form-item">
								<div class="layui-input-block">
									<button class="layui-btn layui-btn-normal" lay-submit lay-filter="formDemo">编辑</button>
								</div>
							</div>

						</form>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script type="text/html" id="sexItem">
		{{# if (d.sex == 1){ }} 男 {{# } else if(d.sex == 2){ }} 女 {{# } else { }} 你是个什么生物？ {{# } }}
	</script>

	<script type="text/html" id="is-type">
		{{# if (d.type == 1){}}
		<span style="color: #FFCE4E;">待审核</span>
		{{# } else if(d.type == 2){ }}
		<span>正常</span>
		{{# } else if(d.type == 3){ }}
		<span style="color: #FF6D3E;">停用</span>
		{{# } }}
	</script>

	<script type="text/html" id="viewapp">
		<ul class="viewInfo">
			<li>
				<span>姓名：</span>{{d.username}}
			</li>
			<li>
				<span>性别：</span>{{d.sex}}
			</li>
			<li>
				<span>部门：</span>{{d.department}}
			</li>
			<li>
				<span>职位：</span>{{d.position}}
			</li>
			<li>
				<span>手机：</span>{{d.phone}}
			</li>
			<li>
				<span>email：</span>{{d.email}}
			</li>
			<li>
				<span>是否启用：</span>{{d.status ? "是" : "否"}}
			</li>
		</ul>
	</script>

	<script type="text/html" id="options">
		{{# if (d.type == 1){}}
		<a class="layui-btn layui-btn-detail layui-btn-xs" lay-event="edit">审核</a>
		{{# } else if(d.type == 2){ }}
		<a class="layui-btn layui-btn-stop layui-btn-xs" lay-event="stop">停用</a>
		{{# } else if(d.type == 3){ }}
		<a class="layui-btn layui-btn-detail layui-btn-xs" lay-event="activation">激活</a>
		{{# } }}
		<a class="layui-btn layui-btn-detail layui-btn-xs" lay-event="detail">详情</a>
	</script>

	<script type="text/javascript">
		layui.use(['table', "form", "jquery", "laytpl", "laydate","layer"], function() {
			var table = layui.table,
				form = layui.form,
				laytpl = layui.laytpl,
				laydate = layui.laydate,
				layer = layui.layer,
				laypage = layui.laypage,
				$ = layui.jquery;
			
			
			$.get("../../json/message.json", {}, function (data) {
		            console.log(data);
//		            if (data.code == 0) {
		                $.each(data, (index, item) => {
		                	console.log(index, item)
		                    $("#typeselect").append(new Option(item.msgId, item.userName));
		                });
		                form.render();
//		            }
		
		
		        });
			//日期选择
			laydate.render({
				elem: '#begindate', //指定元素
				
			});

			laydate.render({
				elem: '#lastdate' //指定元素
			});
			
			
			//第一个实例
			table.render({
				method: 'get',
				elem: '#demo',
				url: '../../json/newsList.json',
			
				page: true, //开启分页
				limit:20,
				cols: [
					[ //表头
						{
							field: 'id',
							title: '编号',
							width: 80,
							sort: true
						}, {
							field: 'name',
							title: '用户名'
						}, {
							field: 'name',
							
							title: 'name',
							sort: true,
							
						}, {
							field: 'name',
							title: '联系人',
							sort: true
						}, {
							field: 'systemId',
							title: '联系电话'
						}, {

							title: '审核状态',
							toolbar: '#is-type'
						}, {
							field: 'createtime',
							title: '注册时间',
							sort: true
						}, {
							field: 'loginetime',
							title: '最后登录时间',

						}, {
							title: '操作',
							toolbar: '#options'
						}
					]
				]
			});

			//搜索
			
			
			$('#searchBtn').on('click',function(){
			        var type = $(this).data('type');
			        active[type] ? active[type].call(this) : '';
			    });
			    // 点击获取数据
			    var  active = {
			 		getInfo: function () {
			            var userName=$('#userName').val();
			            var begindate=$('#begindate').val();
			            var begindate=$('#lastdate').val();
			            console.log(begindate)
			            console.log(userName)
			            if ($('#userName').val()||$('#begindate').val()||$('#lastdate').val()) {
			                var index = layer.msg('查询中，请稍候...',{icon: 16,time:2000,shade:0});
			                setTimeout(function(){
			                    table.reload('demo', {
			                        where: {
			                            'userName':userName
			                        }
			                    });
			                    layer.close(index);
			                },122222);
			            } else {
			                table.reload('demo', {where: {
			                        'userName':userName
			                    }});
			                table.reload('')
			            }
			        }
			    };
			//是否展示
			form.on('switch(isShow)', function(data) {
				var index = layer.msg('修改中，请稍候', {
					icon: 16,
					time: false,
					shade: 0.8
				});
				setTimeout(function() {
					layer.close(index);
					layer.msg("展示状态修改成功！");
				}, 2000);
			})

			//操作
			table.on('tool(test)', function(obj) {
				var data = obj.data;
				if(obj.event === 'stop') {
					layer.open({
						title: "停用" + data.id + "信息",
						type: 1,
						move: false,
						content: $(".appedit"),
						area: ["50%", "80%"],
						success: function() {
							$('input[name="username"]').val(data.username);
							//						$('input[name="sex"]').val(data.sex);
							//						console.log(data.sex)

							if(data.sex == $('input[name="sex"]').val()) {
								console.log($('input[value="1"]').attr('checked'))

								$('input[value="1"]')[0].checked = true
							} else {
								console.log(1)
								$('input[value="2"]').checked = false

							}
							$('input[name="phone"]').val(data.phone);
							$('input[name="gender"]').val(data.gender);
							$('input[name="nichen"]').val(data.nichen);
							$('input[name="birthday"]').val(data.birthday);
						},
						yes: function(data) {
							var mgUser = page.formToJson($('#layer_form').serialize());
							console.log(data)
							//						$.post('', data, function(res) {
							//							userPage.reload(res);
							//						});
						},
						resize: false,
						scrollbar: false,
					})
				

				} else if(obj.event === 'activation') {
					layer.open({
						title: "激活" + data.id + "信息",
						type: 2,
						move: false,
						content:  'edit.html?id=' + data.id,
						area: ["50%", "80%"],
						success: function() {
							$('input[name="username"]').val(data.username);
							$('input[name="phone"]').val(data.phone);
							$('input[name="gender"]').val(data.gender);
							$('input[name="nichen"]').val(data.nichen);
							$('input[name="birthday"]').val(data.birthday);
						},
						yes: function(data) {
							var mgUser = page.formToJson($('#layer_form').serialize());
							console.log(data)
							//						$.post('', data, function(res) {
							//							userPage.reload(res);
							//						});
						},
						resize: false,
						scrollbar: false,
					})
				
				} else if(obj.event === 'edit') {
					layer.open({
						title: "审核" + data.id + "信息",
						type: 2,
						move: false,
						content:  'edit.html?id=' + data.id,
						area: ["50%", "80%"],
						success: function() {
							$('input[name="username"]').val(data.username);
							$('input[name="phone"]').val(data.phone);
							$('input[name="gender"]').val(data.gender);
							$('input[name="nichen"]').val(data.nichen);
							$('input[name="birthday"]').val(data.birthday);
							
						},
						done: function(data) {
							var mgUser = page.formToJson($('#layer_form').serialize());
							console.log(data)
							$.post('', data, function(res) {
								table.reload(res);
							});
						},
						resize: false,
						scrollbar: false,
					})
				}
			});
		});
	</script>

</html>