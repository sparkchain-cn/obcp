<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<title>企业用户列表</title>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="format-detection" content="telephone=no">
<link rel="stylesheet" href="/admin/layui/css/layui.css" media="all" />
<link rel="stylesheet"
	href="//at.alicdn.com/t/font_tnyc012u2rlwstt9.css" media="all" />
<link rel="stylesheet" href="/admin/css/main.css" media="all" />
<link rel="stylesheet" type="text/css" href="/admin/css/form.css" />

<script type="text/javascript" src="/admin/layui/layui.js"></script>
<script type="text/javascript" src="/js/main.js"></script>
<!--<script src="../../js/user/newsList.js" type="text/javascript" charset="utf-8"></script>-->
</head>

<body class="childrenBody layui-bg-gray">
	<div class="layui-fluid layui-bg-white">

		<div class="" id="search_app" class="search">
			<div class="layui-form" action="">
				<div class="layui-form-item layui-form-item1">
					<div class="layui-inline">
						<label class="layui-form-label layui-form-label1">公司名称/编码:</label>
						<div class="layui-input-inline">
							<input type="name" id="textVal" name="textVal" autocomplete="off"
								class="layui-input" placeholder="请输入公司名称/编码">
						</div>
					</div>
				<!-- 	<div class="layui-inline">
						<label class="layui-form-label layui-form-label1">联系电话:</label>
						<div class="layui-input-inline">
							<input type="name" id="mobile" name="mobile" autocomplete="off"
								class="layui-input" placeholder="请输入手机号码">
						</div>
					</div> -->
					
					<div class="layui-inline">
						<button class="layui-btn layui-btn-normal" id="searchBtn"
							data-type="getInfo">
							<i class="layui-icon ">&#xe615;</i> 搜索
						</button>
					</div>
				</div>
				</form>

			</div>
		</div>

		<div class="layui-fluid layui-bg-white">
			<table id="userIndex" lay-filter="userIndex"></table>
		</div>
</body>

<script type="text/html" id="sexItem">
		{{# if (d.sex == 1){ }} 男 {{# } else if(d.sex == 2){ }} 女 {{# } else { }} 你是个什么生物？ {{# } }}
	</script>
<script type="text/html" id="roleName">
			
			{{# 	if(d.roleName){ }}
				{{#		var array = d.roleName.split(",") || [];}}
					{{#	for(var i=0 ;i<array.length ;i++) { }}
							 <button class="layui-btn layui-btn-primary layui-btn-xs" >{{ array[i] }}</button>
					{{#	} }}
			{{#	}else { }}
 						 
				{{# } }}
	</script>

	<script type="text/html" id="state">
		{{# if (d.state == 1){}}
		<span style="color: #FFCE4E;">正常</span>
		{{# } else if(d.state == 2){ }}
		<span>已禁用</span>
		{{# } }}
	</script>
<!-- 	<a class="layui-btn layui-btn-xs" lay-event="bindRole">绑定角色</a>	 -->
<script type="text/html" id="options">		
		<a class="layui-btn layui-btn-xs" lay-event="verify">审核</a>	
	</script>

<script type="text/javascript">
		layui.use(['table', "form", "jquery", "laytpl", "laydate","layer","util"], function() {
			var table = layui.table,
				form = layui.form,
				laytpl = layui.laytpl,
				laydate = layui.laydate,
				layer = layui.layer,
				laypage = layui.laypage,
				util=layui.util,queryObj={state:0},
				$ = layui.jquery,curr=1;
						
			var render = table.render({
				method: 'post',
				elem: '#userIndex',
				url: '/v1/userextend/companyList',
				//contentType:"application/json; charset=UTF-8",				
				page: 1, //开启分页
				limit:10,
				where:queryObj,
				loading:true,
				done:function(res, currPage, count){
		  			curr = currPage;
		  		},
				cols: [
					[ //表头
						{
							field: 'companyname',
							title: '公司名称',
							width: 180,
							align:"center"
						},{
							field: 'nickname',
							title: '联系人',
							width: 180,
							align:"center"
						},
						 {
								field: 'mobile',
								title: '联系电话',
								width: 180,
								align:"center"
							},{
							field: 'corporationname',
							title: '法人',
							width: 180,
							align:"center"
						}, {
							field: 'vip',
							title: '特权用户',
							width: 180,
							align:"center",
							templet:function(item){
								if(item.vip == 0){
									return "普通用户";
								}else{
									return "特权(免费)用户";
								}
							}
						},
						 {
							field: 'createtime',
							title: '注册时间',
							align:"center",
							width: 180,
						  templet:function(item){
			                    if(item.createtime)
			                        return util.toDateString(item.createtime,"yyyy-MM-dd HH:mm:ss");
			                    else
			                        return "";
			                }
						}, 
						{
							title: '操作',
							align:"center",
							toolbar: '#options'
						}
					]
				]
			});
			
			//表格渲染
			var tableRender = function(){
			/* 	var nickname=$('#nickname').val(), mobile = $("#mobile").val(),id = $("#id").val(),queryObj= {};
				if(nickname){queryObj.nickname = nickname.trim();}
				if(mobile){queryObj.mobile = mobile.trim()};
				if(id){queryObj.id = id.trim()}; */
				render.reload({where:queryObj, page: {
				    curr: curr
				  }});	
			}

		   $("#addBtn").on("click",function(){
			   layer.open({
			        type: 2,
			        title: '新增用户',
			        maxmin: true,
			        resize: false,
			        area: ['90%', '100%'],
			        content: '/admin/page/user/userAdd.html',
			        zIndex: layer.zIndex, //重点1,
			        end:function () {	        	
			        	render.reload({where:queryObj, page: {
						    curr: 1
						  }});		        	
			        }
			      });
		   });
			
			//搜索
			
			$('#searchBtn').on('click',function(){	
				var nickname=$('#nickname').val(),mobile = $("#mobile").val(),id = $("#id").val();
				queryObj= {state:0};
				if(nickname){queryObj.nickname = nickname.trim()};		
				if(mobile){queryObj.mobile = mobile.trim()};
				if(id){queryObj.id = id.trim()};
				render.reload({where:queryObj,page: {
				    curr: 1 
				  }});	
			 });
		    // 点击获取数据
		    var  active = {
		 		getInfo: function () {
		          tableRender();
		        }
		    };

			//操作
			table.on('tool(userIndex)', function(obj) {
				var data = obj.data;
				if(obj.event === 'verify') {
					layer.open({
						title: "用户审核",
						type: 2,
						move: false,
						content:  '/user/companyInfo?userId=' + data.id,
						area: ["100%", "100%"],
						end: function() {
							tableRender();				
						},				
						resize: false,
						scrollbar: false,
					})
				}
			});
		});
		
		
	</script>

</html>